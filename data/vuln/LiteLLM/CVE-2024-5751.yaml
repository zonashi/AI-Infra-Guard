info:
  name: LiteLLM
  cve: CVE-2024-5751
  summary: LiteLLM 由于不安全地使用 `eval` 而存在远程代码执行漏洞。
  details: |
    BerriAI/litellm v1.35.8 版本存在一个漏洞，攻击者可以通过该漏洞实现远程代码执行。
    该漏洞存在于 `add_deployment` 函数中，该函数从 base64 解码和解密环境变量，
    并将其分配给 `os.environ`。攻击者可以通过向 `/config/update` 端点发送恶意负载来利用此漏洞，
    当 `get_secret` 函数被触发时，服务器会处理并执行该负载。
    这要求服务器使用 Google KMS 和数据库来存储模型。
  cvss: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  severity: CRITICAL
  security_advise: |
    1. 将 LiteLLM 升级到 1.40.16 或更高版本。
    2. 确保服务器在非绝对必要的情况下不使用 Google KMS 和数据库来存储模型，
       因为这是漏洞利用的先决条件。
    3. 审查并清理所有发送到 `/config/update` 端点的输入，以防止恶意负载注入。
rule: version > "0" && version < "1.40.16"
references:
  - https://nvd.nist.gov/vuln/detail/CVE-2024-5751
  - https://github.com/BerriAI/litellm/pull/4228
  - https://github.com/BerriAI/litellm/commit/fcea4c22ad96b24436f196ae709f71932e84b0b8
  - https://github.com/berriai/litellm
  - https://huntr.com/bounties/ae623c2f-b64b-4245-9ed4-f13a0a5824ce