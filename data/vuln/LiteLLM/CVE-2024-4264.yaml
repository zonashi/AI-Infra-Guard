info:
  name: LiteLLM
  cve: CVE-2024-4264
  summary: LiteLLM 中因不安全使用 `eval` 函数导致远程代码执行。
  details: |
    berriai/litellm 项目中存在一个远程代码执行 (RCE) 漏洞，原因是 `litellm.get_secret()` 方法在不安全地使用 `eval` 函数时，未能正确控制代码生成。具体来说，当服务器使用 Google KMS 时，未经信任的数据被传递给 `eval` 函数，且未进行任何清理。攻击者可以通过向 `/config/update` 端点注入恶意值来利用此漏洞，该端点允许更新 `proxy_server_config.yaml` 中的设置。
  cvss: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H
  severity: HIGH
  security_advise: |
    1. 将 LiteLLM 升级到 1.28.11 以上版本。
    2. 确保在代码生成或评估函数中使用环境变量和配置设置之前，对其进行适当的清理。
    3. 仅限制授权用户访问 `/config/update` 端点。
rule: version > "0" && version <= "1.28.11"
references:
  - https://nvd.nist.gov/vuln/detail/CVE-2024-4264
  - https://github.com/BerriAI/litellm
  - https://github.com/BerriAI/litellm/blob/main/litellm/proxy/proxy_server.py#L2104-L2108
  - https://github.com/BerriAI/litellm/blob/main/litellm/proxy/proxy_server.py#L2118
  - https://github.com/BerriAI/litellm/blob/main/litellm/proxy/proxy_server.py#L2509-L2517
  - https://github.com/BerriAI/litellm/blob/main/litellm/proxy/proxy_server.py#L2562-L2577
  - https://github.com/BerriAI/litellm/blob/main/litellm/utils.py#L9867-L9885
  - https://huntr.com/bounties/a3221b0c-6e25-4295-ab0f-042997e8fc61