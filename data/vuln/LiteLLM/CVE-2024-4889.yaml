info:
  name: LiteLLM
  cve: CVE-2024-4889
  summary: LiteLLM 密钥管理系统中的代码注入漏洞。
  details: |
    berriai/litellm 应用程序版本 1.34.6 中存在一个代码注入漏洞，原因是密钥管理系统中的 `eval` 函数使用了未经验证的输入。此漏洞需要有效的 Google KMS 配置文件才能被利用。具体来说，通过将 `UI_LOGO_PATH` 变量设置为 `get_image` 函数中的远程服务器地址，攻击者可以将恶意 Google KMS 配置文件写入 `cached_logo.jpg` 文件。然后，可以通过将恶意代码分配给 `SAVE_CONFIG_TO_DB` 环境变量来执行任意代码，从而导致完全的系统控制。此漏洞的利用取决于 Google KMS 功能的使用。
  cvss: CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H
  severity: HIGH
  security_advise: |
    1. 将 LiteLLM 升级到已针对 CVE-2024-4889 打补丁的版本。
    2. 避免在 `eval` 函数中使用未经验证的输入。
    3. 对所有用户控制的变量实施严格的输入验证，特别是那些影响文件路径或配置的变量。
    4. 限制将 `UI_LOGO_PATH` 设置为远程服务器地址的能力。
    5. 确保 Google KMS 功能配置安全，并且其配置文件无法被篡改。
rule: version < "1.34.7"
references:
  - https://nvd.nist.gov/vuln/detail/CVE-2024-4889
  - https://huntr.com/bounties/be3fda72-a65b-4993-9a0e-7e0f05db51f8