info:
  name: langchain
  cve: CVE-2025-65106
  summary: LangChain 在提示模板中通过属性访问存在模板注入漏洞，允许攻击者访问 Python 对象的内部结构。
  details: |
    LangChain 的提示模板系统存在模板注入漏洞，攻击者可以通过模板语法访问 Python 对象的内部结构。这会影响在 `ChatPromptTemplate` 和相关类中接受不受信任模板字符串的应用程序。攻击者可以遍历对象属性和字典查找（例如 `__globals__`）以提取敏感数据，如环境变量。此漏洞需要控制模板字符串，而不仅仅是模板变量。受影响的组件包括 `langchain-core` 以及 F 字符串、Mustache 和 Jinja2 模板格式。
  cvss: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:N/VC:H/VI:L/VA:N/SC:N/SI:N/SA:N
  severity: HIGH
  security_advise: |
    1. 审计您的代码中模板字符串来源于不受信任来源的任何位置。
    2. 更新到 `langchain-core` 的已修补版本（>=1.0.7 或 >=0.3.80）。
    3. 审查模板使用，确保模板结构与用户提供的数据之间有明确的分离。
    4. 考虑模板是否必要；许多应用程序可以直接使用消息对象而无需模板。
    5. 由于全面沙盒的困难性，Jinja2 模板仅保留给受信任的来源使用。
rule: (version > "0" && version < "0.3.80") || (version >= "1.0.0" && version < "1.0.7")
references:
  - https://github.com/langchain-ai/langchain/security/advisories/GHSA-6qv9-48xg-fc7f
  - https://nvd.nist.gov/vuln/detail/CVE-2025-65106
  - https://github.com/langchain-ai/langchain/commit/c4b6ba254e1a49ed91f2e268e6484011c540542a
  - https://github.com/langchain-ai/langchain/commit/fa7789d6c21222b85211755d822ef698d3b34e00
  - https://github.com/langchain-ai/langchain